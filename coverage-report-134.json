{
  "programId": 134,
  "programName": "Mise à jour detail session WS",
  "coveragePct": 15,
  "rulesImplemented": 0,
  "rulesTotal": 6,
  "missingRules": [
    "RM-001: Condition Type E - detail type ecarts (routing to histo_sessions_caisse_devise)",
    "RM-002: Condition Nbre devises non zero - active devise detail",
    "RM-003: Condition Type V - detail type ventes (routing to article session history)",
    "RM-004: Condition Type V AND montant produits non zero",
    "RM-005: Condition Quand O AND Type I - ouverture initiale",
    "RM-006: Si ouverture auto alors O sinon vide (partiellement implémenté mais pas testé)"
  ],
  "recommendations": [
    "CRITIQUE: Toutes les 6 règles business sont marquées N/A dans le contrat mais le code généré ne reflète pas la logique backend WS décrite",
    "Le contrat indique clairement que ce programme route vers 4 tables différentes selon le type (E, V, I) mais le code généré n'implémente aucune logique de routing",
    "MANQUE: Aucune distinction entre les 4 tables d'historique (histo_sessions_caisse_article, histo_sessions_caisse_detail, histo_sessions_caisse_devise, histo_sessions_caisse_remise)",
    "MANQUE: Logique conditionnelle pour Type='E' (écarts) -> table devise",
    "MANQUE: Logique conditionnelle pour Type='V' (ventes) -> table article",
    "MANQUE: Condition nbreDevises<>0 pour activer le détail devise",
    "MANQUE: Condition montantProduits<>0 pour écrire le détail article",
    "MANQUE: Traitement spécial pour Quand='O' AND Type='I' (ouverture initiale)",
    "INCOHÉRENCE: Le type SessionDetailActionType permet 'E' | 'V' | 'I' mais aucune logique backend ne traite ces cas différemment",
    "INCOHÉRENCE: Le payload envoyé à POST /api/session-detail/log contient tous les champs mais ne précise pas quelle table cibler",
    "MANQUE ENTITÉS: Pas de types TypeScript pour histo_sessions_caisse_article, histo_sessions_caisse_devise, histo_sessions_caisse_remise",
    "MANQUE SERVICES: Pas d'endpoints séparés pour les 4 types de détail (article, devise, remise, detail)",
    "ARCHITECTURE: Le store actuel est trop générique et ne modélise pas les 4 flux distincts décrits dans la spec",
    "UI: SessionDetailPage affiche 'Programme backend de journalisation (aucune interface visible)' ce qui est correct, mais alors pourquoi créer une page?",
    "SUGGESTION: Créer 4 stores séparés (articleDetail, deviseDetail, remiseDetail, sessionDetail) ou un store avec 4 actions distinctes",
    "SUGGESTION: Implémenter la logique de routing côté frontend pour appeler le bon endpoint selon le type",
    "SUGGESTION: Ajouter des tests unitaires pour valider chaque règle business (RM-001 à RM-006)",
    "RÉGRESSION: Le contrat indique 'Backend-only WS' pour toutes les règles mais le code génère une page UI complète inutile",
    "OPTIMISATION: Si vraiment backend-only, supprimer SessionDetailPage.tsx et ne garder que le store + l'API client"
  ]
}
