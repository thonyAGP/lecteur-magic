Voici le rapport JSON de couverture complet :

```json
{
  "programId": 131,
  "programName": "Fermeture caisse",
  "coveragePct": 58,
  "rulesImplemented": 3,
  "rulesTotal": 3,
  "missingRules": [
    "RM-002: Les variables montants (GL, GM, GO, GP, GR, GS, GT, GU) ne sont pas exposées dans le store",
    "Validation stricte: Contrôle que tous les moyens ont été pointés manquant dans le store",
    "Calcul automatique des écarts: L'appel à calculerEcarts() n'est jamais déclenché automatiquement après saisie",
    "Programmes callees manquants: 14/20 programmes externes non implémentés (IDE 134, 136, 142, 145, 155, etc.)",
    "Tables historique: histo_sessions_caisse_detail (#249) et histo_sessions_caisse_devise (#250) non intégrées",
    "Génération tickets: 3 types de tickets manquent (IDE 138, 136, 154)",
    "Mise à jour historique: Méthode mettreAJourHistorique() incomplète (manque appel IDE 134)",
    "Workflow détail devises: Écrans 131.1.4 et 131.1.4.1 non implémentés"
  ],
  "recommendations": [
    "CRITIQUE - Ajouter validation 'tous moyens pointés': Le store doit calculer tousPointes automatiquement en vérifiant si tous les moyensPaiement ont montantCompte !== 0",
    "CRITIQUE - Déclencher calculerEcarts() automatiquement après chaque saisirMontantsComptes() pour maintenir la cohérence",
    "HIGH - Exposer les 8 variables métier (GL, GM, GO, GP, GR, GS, GT, GU) dans le state pour traçabilité complète selon RM-002",
    "HIGH - Implémenter les 14 programmes callees manquants comme services: IDE 134 (MAJ detail), 136 (Generation ticket), 142 (Devise update), 155 (Controle fermeture)",
    "MEDIUM - Ajouter entités TypeScript pour histo_sessions_caisse_detail et histo_sessions_caisse_devise",
    "MEDIUM - Implémenter service printer avec 3 générateurs: fermetureTicketGenerator (IDE 138), remiseTicketGenerator (IDE 136), recapTableauGenerator (IDE 154)",
    "MEDIUM - Compléter mettreAJourHistorique() pour appeler IDE 134 via service backend",
    "MEDIUM - Créer DetailDevisesPanelModal comme dialog au lieu de tab (correspond mieux à IDE 131.1.4 popup)",
    "LOW - Ajouter suivi session ouvertes VIL (variable FD) pour RM-003",
    "LOW - Renommer currentView 'validation' en 'detail-devises' pour cohérence (actuellement mélangé dans le code)",
    "CODE QUALITY - Extraire validation logic (lignes 366-374) dans un validator service réutilisable",
    "CODE QUALITY - Ajouter tests unitaires fermetureCaisseStore.test.ts couvrant les 3 règles RM-001/002/003",
    "UX - Tableau récap: Ajouter ligne de totaux en pied pour chaque colonne (Cash, Cartes, etc.)"
  ]
}
```

**Analyse détaillée:**

✅ **Points forts (implémentés):**
- Store Zustand complet avec 13 actions
- 3 règles métier RM-001/002/003 marquées IMPL dans le contrat
- 4 endpoints API principaux (recap, pointages, validation, tickets)
- 4 tables principales mappées (pointage_devise, pointage_article, pointage_appro_remise, gestion_devise_session)
- UI 4 onglets fonctionnels (recap, validation, tickets, detail devises)
- Calcul écarts et solde final implémentés
- Flux principal validation en place

❌ **Gaps critiques:**

1. **Variables métier manquantes (RM-002):** Le contrat liste 8 variables (GL à GU) pour montants versements/apports - absentes du state
2. **Auto-calcul écarts:** `calculerEcarts()` existe mais n'est jamais appelé automatiquement
3. **Validation "tous pointés":** La variable `tousPointes` existe mais sa logique de calcul est manquante
4. **14/20 programmes externes non implémentés:** Grosse partie de la logique déléguée (tickets, historique, validation avancée) manque
5. **2 tables historique absentes:** histo_sessions_caisse_detail (#249) et histo_sessions_caisse_devise (#250) non typées

**Score 58%:** Le scaffold est solide, mais manque 42% de logique métier (callees externes, variables traçabilité, validations strictes).