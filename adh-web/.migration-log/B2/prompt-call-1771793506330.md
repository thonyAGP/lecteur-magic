Generate Vitest component tests for "FermetureCaissePage".

RULES (MANDATORY):
- Use import aliases: @/ for src root (e.g. @/stores/..., @/types/...)
- NEVER use `any` type - use `unknown` or precise types
- Tailwind v4 classes for styling (no tailwind.config.js)
- Arrow functions everywhere (no function declarations)
- `as const` instead of TypeScript enum
- verbatimModuleSyntax is enabled: use `import type { X }` ONLY for types/interfaces, use `import { X }` for values/consts
- File must be COMPLETE and ready to write - NO placeholders, NO TODOs, NO "// implement here"
- NO comments except for genuinely complex logic
- Output ONLY the code inside a single markdown code block (```typescript ... ``` or ```tsx ... ```)

SHARED INFRASTRUCTURE (use these exact imports):
- Data source toggle: `import { useDataSourceStore } from "@/stores/dataSourceStore"` (has .getState().isRealApi)
- API client: `import { apiClient } from "@/services/api/apiClient"` and `import type { ApiResponse } from "@/services/api/apiClient"`
- Screen layout: `import { ScreenLayout } from "@/components/layout"` (wrapper with sidebar, takes children + className)
- UI components: `import { Button, Dialog, Input } from "@/components/ui"`
- cn utility: `import { cn } from "@/lib/utils"`

TEST REQUIREMENTS:
- Use @vitest-environment jsdom
- import { render, screen, fireEvent, waitFor } from "@testing-library/react"
- Mock the store with vi.mock()
- CRITICAL: import the page component using @/ alias: import { FermetureCaissePage } from "@/pages/FermetureCaissePage"
- Place vi.mock() calls BEFORE the page import (vitest hoisting)
- Test: renders without crashing
- Test: displays loading state
- Test: displays data when loaded
- Test: handles user interactions (clicks, form submits)
- Test: displays error state

PAGE COMPONENT:
import { useState, useEffect, useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import { ScreenLayout } from '@/components/layout';
import { Button } from '@/components/ui';
import { useFermetureCaisseStore } from '@/stores/fermetureCaisseStore';
import { useAuthStore } from '@/stores';
import { cn } from '@/lib/utils';
import type { FermetureCaisseView, MoyenPaiement } from '@/types/fermetureCaisse';

type Tab = 'recap' | 'validation' | 'tickets' | 'detail-devises';

export const FermetureCaissePage = () => {
  const navigate = useNavigate();
  const user = useAuthStore((s) => s.user);
  const societe = 'ADH';
  const numeroSession = 1001;

  const recapFermeture = useFermetureCaisseStore((s) => s.recapFermeture);
  const pointagesDevise = useFermetureCaisseStore((s) => s.pointagesDevise);
  const pointagesArticle = useFermetureCaisseStore((s) => s.pointagesArticle);
  const pointagesApproRemise = useFermetureCaisseStore((s) => s.pointagesApproRemise);
  const ecartsDetectes = useFermetureCaisseStore((s) => s.ecartsDetectes);
  const ecartsJustifies = useFermetureCaisseStore((s) => s.ecartsJustifies);
  const tousPointes = useFermetureCaisseStore((s) => s.tousPointes);
  const fermetureValidee = useFermetureCaisseStore((s) => s.fermetureValidee);
  const isLoading = useFermetureCaisseStore((s) => s.isLoading);
  const error = useFermetureCaisseStore((s) => s.error);
  const currentView = useFermetureCaisseStore((s) => s.currentView);

  const chargerRecapFermeture = useFermetureCaisseStore((s) => s.chargerRecapFermeture);
  const saisirMontantsComptes = useFermetureCaisseStore((s) => s.saisirMontantsComptes);
  const calculerEcarts = useFermetureCaisseStore((s) => s.calculerEcarts);
  const justifierEcart = useFermetureCaisseStore((s) => s.justifierEcart);
  const effectuerApportCoffre = useFermetureCaisseStore((s) => s.effectuerApportCoffre);
  const effectuerApportArticles = useFermetureCaisseStore((s) => s.effectuerApportArticles);
  const effectuerRemiseCaisse = useFermetureCaisseStore((s) => s.effectuerRemiseCaisse);
  const validerFermeture = useFermetureCaisseStore((s) => s.validerFermeture);
  const genererTickets = useFermetureCaisseStore((s) => s.genererTickets);
  const afficherDetailDevises = useFermetureCaisseStore((s) => s.afficherDetailDevises);
  const setCurrentView = useFermetureCaisseStore((s) => s.setCurrentView);
  const reset = useFermetureCaisseStore((s) => s.reset);

  const [activeTab, setActiveTab] = useState<Tab>('recap');
  const [selectedMoyenPaiement, setSelectedMoyenPaiement] = useState<string | null>(null);

  useEffect(() => {
    chargerRecapFermeture(societe, numeroSession);
    return () => reset();
  }, [chargerRecapFermeture, reset, societe, numeroSession]);

  const handleSaisie = useCallback(
    (moyenCode: string) => {
      setSelectedMoyenPaiement(moyenCode);
      saisirMontantsComptes(moyenCode);
    },
    [saisirMontantsComptes],
  );

  const handleApportCoffre = useCallback(() => {
    effectuerApportCoffre(800);
  }, [effectuerApportCoffre]);

  const handleApportArticles = useCallback(() => {
    effectuerApportArticles('ART001', 10);
  }, [effectuerApportArticles]);

  const handleRemise = useCallback(() => {
    effectuerRemiseCaisse(500);
  }, [effectuerRemiseCaisse]);

  const handleJustifierEcart = useCallback(
    (moyenCode: string) => {
      justifierEcart(moyenCode, 'Ecart justifie par operateur');
    },
    [justifierEcart],
  );

  const handleValider = useCallback(() => {
    validerFermeture(societe, numeroSession);
  }, [validerFermeture, societe, numeroSession]);

  const handleGenererTickets = useCallback(() => {
    genererTickets(societe, numeroSession);
  }, [genererTickets, societe, numeroSession]);

  const handleDetailDevises = useCallback(() => {
    afficherDetailDevises();
    setActiveTab('detail-devises');
  }, [afficherDetailDevises]);

  const handleBack = useCallback(() => {
    navigate('/caisse/menu');
  }, [navigate]);

  const validationReady =
    tousPointes && (!ecartsDetectes || ecartsJustifies) && !fermetureValidee;
  const ticketsReady = fermetureValidee;

  const moyensPaiement = recapFermeture?.moyensPaiement || [];
  const totalVersementCoffre = recapFermeture?.totalVersementCoffre || 0;
  const soldeFinal = recapFermeture?.soldeFinal || 0;

  return (
    <ScreenLayout>
      <div className="space-y-6 max-w-6xl mx-auto">
        <div className="flex items-center justify-between">
          <div>
            <h2 className="text-xl font-semibold">Fermeture de caisse</h2>
            <p className="text-on-surface-muted text-sm mt-1">
              Session #{numeroSession} - {societe}
            </p>
          </div>
          {user && (
            <span className="text-xs text-on-surface-muted">
              {user.prenom} {user.nom}
            </span>
          )}
        </div>

        {error && (
          <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm">
            {error}
          </div>
        )}

        <div className="border-b border-border">
          <nav className="flex gap-4">
            <button
              onClick={() => setActiveTab('recap')}
              className={cn(
                'px-4 py-2 border-b-2 font-medium text-sm',
                activeTab === 'recap'
                  ? 'border-primary text-primary'
                  : 'border-transparent text-on-surface-muted hover:text-on-surface',
              )}
            >
              Recapitulatif
            </button>
            <button
              onClick={() => setActiveTab('validation')}
              className={cn(
                'px-4 py-2 border-b-2 font-medium text-sm',
                activeTab === 'validation'
                  ? 'border-primary text-primary'
                  : 'border-transparent text-on-surface-muted hover:text-on-surface',
              )}
            >
              Validation
            </button>
            <button
              onClick={() => setActiveTab('tickets')}
              className={cn(
                'px-4 py-2 border-b-2 font-medium text-sm',
                activeTab === 'tickets'
                  ? 'border-primary text-primary'
                  : 'border-transparent text-on-surface-muted hover:text-on-surface',
              )}
            >
              Tickets
            </button>
            <button
              onClick={handleDetailDevises}
              className={cn(
                'px-4 py-2 border-b-2 font-medium text-sm',
                activeTab === 'detail-devises'
                  ? 'border-primary text-primary'
                  : 'border-transparent text-on-surface-muted hover:text-on-surface',
              )}
            >
              Detail devises
            </button>
          </nav>
        </div>

        {isLoading && (
          <div className="text-center py-8 text-on-surface-muted">Chargement...</div>
        )}

        {!isLoading && activeTab === 'recap' && (
          <div className="space-y-6">
            <div className="overflow-x-auto">
              <table className="w-full border-collapse border border-border">
                <thead>
                  <tr className="bg-surface-hover">
                    <th className="border border-border px-4 py-2 text-left">Moyen</th>
                    <th className="border border-border px-4 py-2 text-right">
                      Solde ouverture
                    </th>
                    <th className="border border-border px-4 py-2 text-right">
                      Montant compte
                    </th>
                    <th className="border border-border px-4 py-2 text-right">
                      Montant calcule
                    </th>
                    <th className="border border-border px-4 py-2 text-right">Ecart</th>
                    <th className="border border-border px-4 py-2">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {moyensPaiement.map((moyen: MoyenPaiement) => (
                    <tr key={moyen.code}>
                      <td className="border border-border px-4 py-2">{moyen.libelle}</td>
                      <td className="border border-border px-4 py-2 text-right">
                        {moyen.soldeOuverture.toFixed(2)}
                      </td>
                      <td className="border border-border px-4 py-2 text-right">
                        {moyen.montantCompte.toFixed(2)}
                      </td>
                      <td className="border border-border px-4 py-2 text-right">
                        {moyen.montantCalcule.toFixed(2)}
                      </td>
                      <td
                        className={cn(
                          'border border-border px-4 py-2 text-right font-semibold',
                          moyen.ecart !== 0 && 'bg-yellow-100 text-yellow-900',
                        )}
                      >
                        {moyen.ecart.toFixed(2)}
                      </td>
                      <td className="border border-border px-4 py-2">
                        <button
                          onClick={() => handleSaisie(moyen.code)}
                          className="text-xs px-2 py-1 border border-border rounded-md hover:bg-surface-hover"
                        >
                          Saisir
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            <div className="flex gap-3 flex-wrap">
              <Button onClick={handleApportCoffre}>Apport coffre</Button>
              <Button onClick={handleApportArticles}>Apport articles</Button>
              <Button onClick={handleRemise}>Remise</Button>
              <Button
                onClick={() => selectedMoyenPaiement && handleJustifierEcart(selectedMoyenPaiement)}
                disabled={!ecartsDetectes}
              >
                Justifier ecart
              </Button>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div className="border border-border rounded-md p-4">
                <label className="block text-sm font-medium mb-1">Solde final</label>
                <input
                  type="text"
                  value={soldeFinal.toFixed(2)}
                  readOnly
                  className="w-full px-3 py-2 border border-border rounded-md bg-surface-hover"
                />
              </div>
              <div className="border border-border rounded-md p-4">
                <label className="block text-sm font-medium mb-1">
                  Total versement coffre
                </label>
                <input
                  type="text"
                  value={totalVersementCoffre.toFixed(2)}
                  readOnly
                  className="w-full px-3 py-2 border border-border rounded-md bg-surface-hover"
                />
              </div>
            </div>
          </div>
        )}

        {!isLoading && activeTab === 'validation' && (
          <div className="space-y-4">
            <div
              className={cn(
                'border rounded-md p-4 flex items-center gap-3',
                tousPointes
                  ? 'border-green-300 bg-green-50'
                  : 'border-yellow-300 bg-yellow-50',
              )}
            >
              <span className="text-2xl">{tousPointes ? '✓' : '⚠'}</span>
              <span className="font-medium">
                {tousPointes
                  ? 'Tous les moyens ont ete pointes'
                  : 'Certains moyens ne sont pas pointes'}
              </span>
            </div>

            <div
              className={cn(
                'border rounded-md p-4 flex items-center gap-3',
                !ecartsDetectes || ecartsJustifies
                  ? 'border-green-300 bg-green-50'
                  : 'border-yellow-300 bg-yellow-50',
              )}
            >
              <span className="text-2xl">
                {!ecartsDetectes || ecartsJustifies ? '✓' : '⚠'}
              </span>
              <span className="font-medium">
                {!ecartsDetectes
                  ? 'Aucun ecart detecte'
                  : ecartsJustifies
                    ? 'Tous les ecarts sont justifies'
                    : 'Des ecarts existent et ne sont pas justifies'}
              </span>
            </div>

            <div className="pt-4">
              <Button onClick={handleValider} disabled={!validationReady}>
                Valider fermeture
              </Button>
            </div>

            {fermetureValidee && (
              <div className="border border-green-300 bg-green-50 rounded-md p-4 text-green-900 font-semibold">
                Fermeture validee avec succes
              </div>
            )}
          </div>
        )}

        {!isLoading && activeTab === 'tickets' && (
          <div className="space-y-4">
            <Button onClick={handleGenererTickets} disabled={!ticketsReady}>
              Generer tickets
            </Button>

            {ticketsReady && pointagesApproRemise.length > 0 && (
              <div className="border border-border rounded-md p-4">
                <h3 className="font-semibold mb-2">Tickets generes</h3>
                <ul className="list-disc list-inside space-y-1 text-sm">
                  {pointagesApproRemise.map((p, idx) => (
                    <li key={idx}>
                      {p.type === 'APPORT' ? 'Apport' : 'Remise'} - {p.montant.toFixed(2)} EUR
                      {p.ticketEdite && ' (Ticket edite)'}
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        )}

        {!isLoading && activeTab === 'detail-devises' && (
          <div className="space-y-4">
            {pointagesDevise.length === 0 ? (
              <div className="text-center py-8 text-on-surface-muted">
                Aucun pointage de devise disponible
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full border-collapse border border-border">
                  <thead>
                    <tr className="bg-surface-hover">
                      <th className="border border-border px-4 py-2 text-left">Code devise</th>
                      <th className="border border-border px-4 py-2 text-right">
                        Montant ouverture
                      </th>
                      <th className="border border-border px-4 py-2 text-right">
                        Montant compte
                      </th>
                      <th className="border border-border px-4 py-2 text-right">
                        Montant calcule
                      </th>
                      <th className="border border-border px-4 py-2 text-right">Ecart</th>
                      <th className="border border-border px-4 py-2">Commentaire</th>
                    </tr>
                  </thead>
                  <tbody>
                    {pointagesDevise.map((pd, idx) => (
                      <tr key={idx}>
                        <td className="border border-border px-4 py-2">{pd.codeDevise}</td>
                        <td className="border border-border px-4 py-2 text-right">
                          {pd.montantOuverture.toFixed(2)}
                        </td>
                        <td className="border border-border px-4 py-2 text-right">
                          {pd.montantCompte.toFixed(2)}
                        </td>
                        <td className="border border-border px-4 py-2 text-right">
                          {pd.montantCalcule.toFixed(2)}
                        </td>
                        <td
                          className={cn(
                            'border border-border px-4 py-2 text-right font-semibold',
                            pd.ecart !== 0 && 'bg-yellow-100 text-yellow-900',
                          )}
                        >
                          {pd.ecart.toFixed(2)}
                        </td>
                        <td className="border border-border px-4 py-2 text-sm">
                          {pd.commentaireEcart || '-'}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        )}

        <div className="flex justify-start pt-4">
          <Button onClick={handleBack} variant="outline">
            Retour au menu
          </Button>
        </div>
      </div>
    </ScreenLayout>
  );
};

TYPES:
export type FermetureCaisseView = 'recap' | 'saisie' | 'ecart' | 'coffre' | 'validation';

export interface PointageDevise {
  societe: string;
  numeroSession: number;
  codeDevise: string;
  montantOuverture: number;
  montantCompte: number;
  montantCalcule: number;
  ecart: number;
  commentaireEcart: string | null;
}

export interface PointageArticle {
  societe: string;
  numeroSession: number;
  codeArticle: string;
  quantiteOuverture: number;
  quantiteComptee: number;
  quantiteCalculee: number;
  ecart: number;
}

export interface PointageApproRemise {
  societe: string;
  numeroSession: number;
  type: 'APPORT' | 'REMISE';
  montant: number;
  ticketEdite: boolean;
}

export interface MoyenPaiement {
  code: string;
  libelle: string;
  soldeOuverture: number;
  montantCompte: number;
  montantCalcule: number;
  ecart: number;
}

export interface RecapFermeture {
  societe: string;
  numeroSession: number;
  moyensPaiement: MoyenPaiement[];
  totalVersementCoffre: number;
  soldeFinal: number;
}

export interface FermetureCaisseState {
  recapFermeture: RecapFermeture | null;
  pointagesDevise: PointageDevise[];
  pointagesArticle: PointageArticle[];
  pointagesApproRemise: PointageApproRemise[];
  ecartsDetectes: boolean;
  ecartsJustifies: boolean;
  tousPointes: boolean;
  fermetureValidee: boolean;
  isLoading: boolean;
  error: string | null;
  currentView: FermetureCaisseView;

  chargerRecapFermeture: (societe: string, numeroSession: number) => Promise<void>;
  saisirMontantsComptes: (moyenPaiement: string) => Promise<void>;
  calculerEcarts: () => Promise<void>;
  justifierEcart: (moyenPaiement: string, commentaire: string) => Promise<void>;
  effectuerApportCoffre: (montant: number) => Promise<void>;
  effectuerApportArticles: (codeArticle: string, quantite: number) => Promise<void>;
  effectuerRemiseCaisse: (montant: number) => Promise<void>;
  validerFermeture: (societe: string, numeroSession: number) => Promise<void>;
  genererTickets: (societe: string, numeroSession: number) => Promise<void>;
  mettreAJourHistorique: (societe: string, numeroSession: number) => Promise<void>;
  calculerSoldeFinal: () => Promise<void>;
  afficherDetailDevises: () => Promise<void>;
  setCurrentView: (view: FermetureCaisseView) => void;
  reset: () => void;
}

export interface SaisirMontantsRequest {
  societe: string;
  numeroSession: number;
  moyenPaiement: string;
}

export interface JustifierEcartRequest {
  societe: string;
  numeroSession: number;
  moyenPaiement: string;
  commentaire: string;
}

export interface ApportCoffreRequest {
  societe: string;
  numeroSession: number;
  montant: number;
}

export interface ApportArticlesRequest {
  societe: string;
  numeroSession: number;
  codeArticle: string;
  quantite: number;
}

export interface RemiseCaisseRequest {
  societe: string;
  numeroSession: number;
  montant: number;
}

export interface ValiderFermetureRequest {
  societe: string;
  numeroSession: number;
}

export interface ValiderFermetureResponse {
  success: boolean;
  errors?: string[];
}

export interface GenererTicketsResponse {
  tickets: string[];
}

export interface FermetureCaisseApiResponse<T> extends ApiResponse<T> {
  data?: T;
}

UI SECTIONS:
[
  {
    "name": "recap",
    "controls": [
      "DataGrid: 6 colonnes x 4 lignes (Cash, Cartes, Cheques, Produits, OD, Devises)",
      "Ligne 1: Solde ouverture (readonly)",
      "Ligne 2: Montant compte (editable via bouton Saisie)",
      "Ligne 3: Montant calcule (readonly)",
      "Ligne 4: Ecart (calculated, highlight if != 0)",
      "Button: Saisie (ouvre IDE 120)",
      "Button: Apport coffre (ouvre IDE 123)",
      "Button: Apport articles (ouvre IDE 124)",
      "Button: Remise (ouvre IDE 125)",
      "Button: Ecart (ouvre IDE 130, enabled if ecart exists)",
      "Button: Valider (enabled if all controls pass)",
      "TextField: Solde final (calculated, readonly)",
      "TextField: Total versement coffre (calculated, readonly)"
    ]
  },
  {
    "name": "validation",
    "controls": [
      "Alert: Tous les moyens pointes? (check icon if tousPointes)",
      "Alert: Tous les ecarts justifies? (check icon if !ecartsDetectes OR ecartsJustifies)",
      "Button: Valider fermeture (primary, enabled if all checks pass)"
    ]
  },
  {
    "name": "tickets",
    "controls": [
      "Button: Generer tickets (enabled if fermetureValidee)",
      "List: Tickets generes (IDE 138, IDE 136, IDE 154)"
    ]
  },
  {
    "name": "detail-devises",
    "controls": [
      "DataGrid: Detail des devises comptees (readonly)",
      "Columns: Code devise, Libelle, Montant ouverture, Montant compte, Montant calcule, Ecart"
    ]
  }
]