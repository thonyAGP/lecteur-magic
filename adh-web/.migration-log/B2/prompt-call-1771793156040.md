Generate a React page component for the "GestionCaisse" domain.

RULES (MANDATORY):
- Use import aliases: @/ for src root (e.g. @/stores/..., @/types/...)
- NEVER use `any` type - use `unknown` or precise types
- Tailwind v4 classes for styling (no tailwind.config.js)
- Arrow functions everywhere (no function declarations)
- `as const` instead of TypeScript enum
- verbatimModuleSyntax is enabled: use `import type { X }` ONLY for types/interfaces, use `import { X }` for values/consts
- File must be COMPLETE and ready to write - NO placeholders, NO TODOs, NO "// implement here"
- NO comments except for genuinely complex logic
- Output ONLY the code inside a single markdown code block (```typescript ... ``` or ```tsx ... ```)

SHARED INFRASTRUCTURE (use these exact imports):
- Data source toggle: `import { useDataSourceStore } from "@/stores/dataSourceStore"` (has .getState().isRealApi)
- API client: `import { apiClient } from "@/services/api/apiClient"` and `import type { ApiResponse } from "@/services/api/apiClient"`
- Screen layout: `import { ScreenLayout } from "@/components/layout"` (wrapper with sidebar, takes children + className)
- UI components: `import { Button, Dialog, Input } from "@/components/ui"`
- cn utility: `import { cn } from "@/lib/utils"`

PAGE REQUIREMENTS:
- Use store via useGestionCaisseStore()
- Destructure 20+ fields from store
- useCallback for event handlers
- useEffect for init + cleanup (call reset on unmount)
- ScreenLayout wrapper from @/components/layout (import { ScreenLayout } from "@/components/layout")
- ScreenLayout takes children + className props (no title prop)
- Tailwind v4 classes for styling
- Handle loading, error, and empty states

UI LAYOUT:
{
  "type": "dashboard-with-actions",
  "sections": [
    {
      "name": "headerSection",
      "controls": [
        "operateurNom",
        "dateComptable",
        "sessionStatut"
      ]
    },
    {
      "name": "montantsSection",
      "controls": [
        "montantOuverture",
        "montantActuel",
        "montantFermeture",
        "ecart"
      ]
    },
    {
      "name": "alertesSection",
      "controls": [
        "sessionsConcurrentesList",
        "integriteCoffre"
      ]
    },
    {
      "name": "actionsSection",
      "controls": [
        "btnOuvrirSession",
        "btnFermerSession",
        "btnApportCoffre",
        "btnApportProduit",
        "btnRemiseCoffre",
        "btnHistorique",
        "btnConsultation",
        "btnReimprimer"
      ]
    },
    {
      "name": "mouvementsSection",
      "controls": [
        "mouvementsGrid"
      ]
    }
  ]
}

STORE INTERFACE (actions and state available):
import { create } from 'zustand';
import type {
  SessionCaisse,
  ParametresCaisse,
  SessionConcurrente,
  MouvementCaisse,
  DateComptable,
  GestionCaisseState,
} from '@/types/gestionCaisse';
import { apiClient } from '@/services/api/apiClient';
import type { ApiResponse } from '@/services/api/apiClient';
import { useDataSourceStore } from '@/stores/dataSourceStore';

const MOCK_PARAMETRES: ParametresCaisse = {
  caisseId: 1,
  seuilAlerte: 100,
  deviseLocale: 'EUR',
  impressionAuto: true,
};

const MOCK_SESSION_ACTIVE: SessionCaisse = {
  sessionId: 1001,
  dateOuverture: '2026-02-22T08:00:00',
  dateFermeture: null,
  operateurId: 5,
  operateurNom: 'DUPONT Jean',
  statut: 'ouverte',
  montantOuverture: 500,
  montantFermeture: null,
  ecart: null,
};

const MOCK_SESSIONS_CONCURRENTES: SessionConcurrente[] = [
  {
    sessionId: 1002,
    posteId: 'CAISSE-02',
    operateurNom: 'MARTIN Sophie',
    dateOuverture: '2026-02-22T08:15:00',
  },
  {
    sessionId: 1003,
    posteId: 'CAISSE-03',
    operateurNom: 'DURAND Pierre',
    dateOuverture: '2026-02-22T08:30:00',
  },
];

const MOCK_MOUVEMENTS: MouvementCaisse[] = [
  {
    mouvementId: 1,
    sessionId: 1001,
    type: 'apport_coffre',
    deviseCode: 'EUR',
    montant: 200,
    dateHeure: '2026-02-22T09:00:00',
  },
  {
    mouvementId: 2,
    sessionId: 1001,
    type: 'apport_coffre',
    deviseCode: 'USD',
    montant: 150,
    dateHeure: '2026-02-22T10:30:00',
  },
  {
    mouvementId: 3,
    sessionId: 1001,
    type: 'remise_coffre',
    deviseCode: 'EUR',
    montant: 100,
    dateHeure: '2026-02-22T14:00:00',
  },
];

const MOCK_HISTORIQUE: SessionCaisse[] = [
  {
    sessionId: 995,
    dateOuverture: '2026-02-21T08:00:00',
    dateFermeture: '2026-02-21T18:00:00',
    operateurId: 5,
    operateurNom: 'DUPONT Jean',
    statut: 'fermee',
    montantOuverture: 500,
    montantFermeture: 1245.5,
    ecart: 2.5,
  },
  {
    sessionId: 996,
    dateOuverture: '2026-02-20T08:00:00',
    dateFermeture: '2026-02-20T18:30:00',
    operateurId: 7,
    operateurNom: 'BERNARD Claire',
    statut: 'fermee',
    montantOuverture: 500,
    montantFermeture: 982,
    ecart: -5,
  },
  {
    sessionId: 997,
    dateOuverture: '2026-02-19T08:00:00',
    dateFermeture: '2026-02-19T17:45:00',
    operateurId: 5,
    operateurNom: 'DUPONT Jean',
    statut: 'fermee',
    montantOuverture: 500,
    montantFermeture: 1567.75,
    ecart: 0,
  },
  {
    sessionId: 998,
    dateOuverture: '2026-02-18T08:00:00',
    dateFermeture: '2026-02-18T18:15:00',
    operateurId: 9,
    operateurNom: 'PETIT Laurent',
    statut: 'fermee',
    montantOuverture: 500,
    montantFermeture: 734.25,
    ecart: 12.5,
  },
  {
    sessionId: 999,
    dateOuverture: '2026-02-17T08:00:00',
    dateFermeture: '2026-02-17T18:00:00',
    operateurId: 7,
    operateurNom: 'BERNARD Claire',
    statut: 'fermee',
    montantOuverture: 500,
    montantFermeture: 1123,
    ecart: -3,
  },
];

const MOCK_DATE_COMPTABLE: D

TYPES:
import type { ApiResponse } from "@/services/api/apiClient";

export type SessionStatut = "ouverte" | "fermee" | "cloture_en_cours" | "suspendue";
export type MouvementType = "apport_coffre" | "remise_coffre" | "apport_produit" | "retrait_produit";
export type DeviseCode = string;

export interface SessionCaisse {
  sessionId: number;
  dateOuverture: string;
  dateFermeture: string | null;
  operateurId: number;
  operateurNom: string;
  statut: SessionStatut;
  montantOuverture: number;
  montantFermeture: number | null;
  ecart: number | null;
}

export interface ParametresCaisse {
  caisseId: number;
  seuilAlerte: number;
  deviseLocale: string;
  impressionAuto: boolean;
}

export interface SessionCoffre {
  sessionId: number;
  montantCoffre: number;
  integrite: boolean;
}

export interface MouvementCaisse {
  mouvementId: number;
  sessionId: number;
  type: MouvementType;
  deviseCode: string;
  montant: number;
  dateHeure: string;
}

export interface SessionConcurrente {
  sessionId: number;
  posteId: string;
  operateurNom: string;
  dateOuverture: string;
}

export interface DateComptable {
  date: string;
  valide: boolean;
}

export interface ApportCoffreRequest {
  montant: number;
  deviseCode: string;
}

export interface ApportProduitRequest {
  produitId: number;
  quantite: number;
}

export interface RemiseCoffre Request {
  montant: number;
  deviseCode: string;
}

export interface HistoriqueQueryParams {
  dateDebut?: string;
  dateFin?: string;
  operateurId?: number;
}

export type OuvrirSessionResponse = ApiResponse<SessionCaisse>;
export type FermerSessionResponse = ApiResponse<SessionCaisse>;
export type ApportCoffReResponse = ApiResponse<MouvementCaisse>;
export type ApportProduitResponse = ApiResponse<MouvementCaisse>;
export type RemiseCoffre Response = ApiResponse<MouvementCaisse>;
export type ParametresCaisseResponse = ApiResponse<ParametresCaisse>;
export type SessionActiveResponse = ApiResponse<SessionCaisse | null>;
export type DateComptableResponse = ApiResponse<DateComptable>;
export type SessionsConcurrentesResponse = ApiResponse<SessionConcurrente[]>;
export type HistoriqueResponse = ApiResponse<SessionCaisse[]>;
export type SessionDetailResponse = ApiResponse<SessionCaisse>;
export type MouvementsResponse = ApiResponse<MouvementCaisse[]>;
export type ReimprimerTicketsResponse = ApiResponse<void>;

export interface GestionCaisseState {
  sessionActive: SessionCaisse | null;
  parametres: ParametresCaisse | null;
  sessionsConcurrentes: SessionConcurrente[];
  mouvements: MouvementCaisse[];
  historique: SessionCaisse[];
  dateComptable: DateComptable | null;
  isLoading: boolean;
  error: string | null;
  showHistoriqueDialog: boolean;
  showConsultationDialog: boolean;
  selectedSessionId: number | null;

  chargerParametres: () => Promise<void>;
  chargerSessionActive: () => Promise<void>;
  verifierDateComptable: () => Promise<void>;
  controlerCoffre: () => Promise<void>;
  detecterSessionsConcurrentes: () => Promise<void>;
  ouvrirSession: () => Promise<void>;
  apportCoffre: (montant: number, deviseCode: string) => Promise<void>;
  apportProduit: (produitId: number, quantite: number) => Promise<void>;
  remiseCoffre: (montant: number, deviseCode: string) => Promise<void>;
  fermerSession: () => Promise<void>;
  consulterHistorique: () => Promise<void>;
  consulterSession: (sessionId: number) => Promise<void>;
  reimprimerTickets: (sessionId: number) => Promise<void>;
  setShowHistoriqueDialog: (show: boolean) => void;
  setShowConsultationDialog: (show: boolean) => void;
  setSelectedSessionId: (sessionId: number | null) => void;
  setError: (error: string | null) => void;
}

export const SESSION_STATUT_LABELS = {
  ouverte: "Ouverte",
  fermee: "Fermée",
  cloture_en_cours: "Clôture en cours",
  suspendue: "Suspendue",
} as const;

export const MOUVEMENT_TYPE_LABELS = {
  apport_coffre: "Apport coffre",
  remise_coffre: "Remise coffre",
  apport_produit: "Apport produit",
  retrait_produit: "Retrait produit",
} as const;

export const MOUVEMENT_TYPE_OPTIONS = [
  { value: "apport_coffre" as const, label: MOUVEMENT_TYPE_LABELS.apport_coffre },
  { value: "remise_coffre" as const, label: MOUVEMENT_TYPE_LABELS.remise_coffre },
  { value: "apport_produit" as const, label: MOUVEMENT_TYPE_LABELS.apport_produit },
  { value: "retrait_produit" as const, label: MOUVEMENT_TYPE_LABELS.retrait_produit },
] as const;

export const SESSION_STATUT_OPTIONS = [
  { value: "ouverte" as const, label: SESSION_STATUT_LABELS.ouverte },
  { value: "fermee" as const, label: SESSION_STATUT_LABELS.fermee },
  { value: "cloture_en_cours" as const, label: SESSION_STATUT_LABELS.cloture_en_cours },
  { value: "suspendue" as const, label: SESSION_STATUT_LABELS.suspendue },
] as const;

SPEC UI DESCRIPTION:
> **Structure**: 4 onglets (Resume | Ecrans | Donnees | Connexions)
| Taches | 32 (2 ecrans visibles) |
**Gestion caisse** (Public Name : `Gestion_Caisse_142`) est l'ecran principal de gestion du point de vente Club Med (ID ecran CA0142). Ce programme MDI orchestre toutes les operations de caisse : ouverture et fermeture de session, approvisionnement en especes et produits, remise au coffre, consultation d'historique et reimpression de tickets. Il comporte 32 taches et modifie 4 tables liees aux sessions. Le programme est accessible depuis [Menu caisse GM - scroll (IDE 163)](ADH-IDE-163.md) et [Fermeture Sessions (IDE 281)](ADH-IDE-281.md).
Au demarrage, le programme charge les parametres de caisse depuis la table `parametres_caisse` (table 697) via les taches 121.1 et 121.3 (8 + 12 lignes). 121.2 "Controle COFFRE2" (33 lignes) verifie l'integrite des donnees du coffre dans `sessions_coffre2` (caisse_session_coffre2) en appelant [Controle fermeture caisse WS (IDE 155)](ADH-IDE-155.md) et [Verif session caisse ouverte2 (IDE 156)](ADH-IDE-156.md). 121.4 lit la date comptable dans `date_comptable___dat` (table 70) pour s'assurer que la journee comptable est valide. 121.5 "Lecture session" (31 lignes) lit la table `histo_sessions_caisse` (caisse_session) pour determiner l'etat courant de la session (ouverte, fermee, en cloture) et appelle [Controles - Integrite dates (IDE 48)](ADH-IDE-48.md).
- **121.2** - Controle COFFRE2 (33 lignes, lit sessions_coffre2)
### Ecran de pilotage
La tache 121.6 "Pilotage" (128 lignes, ecran SDI 939x178 DLU) est l'ecran principal visible par l'operateur (Gestion de la caisse). Il affiche l'etat de la caisse avec les montants courants et propose un menu d'actions : ouvrir/fermer la session, realiser des apports ou remises, consulter l'historique. Cet ecran appelle [Calcul concurrence sessions (IDE 116)](ADH-IDE-116.md) (12 fois) pour detecter les sessions paralleles, [Recuperation du titre (IDE 43)](ADH-IDE-43.md) pour le nom de l'operateur, et [Raisons utilisation ADH (IDE 231)](ADH-IDE-231.md) pour le contexte fonctionnel. 121.6.12 "Browse - Concurrence sessions" (6 lignes, ecran) affiche la liste des sessions concurrentes dans `concurrence_sessions` (caisse_concurrences) pour alerter si plusieurs postes sont ouverts simultanement.
- **121.6** - Pilotage (128 lignes, lit table 740, **[ECRAN]**)
- **121.6.12** - Browse - Concurrence sessions (6 lignes, ecrit concurrence_sessions, **[ECRAN]**)
L'ouverture de session est geree par la sous-tache 121.6.2 (59 lignes) qui verifie d'abord qu'aucune cloture n'est en cours (121.6.2.1 lit `reseau_cloture___rec`, table 23), puis controle la coherence des stocks monnaie et produit (121.6.2.2, 13 lignes, lit table 198). La tache 121.6.2.3 "Creation histo session" (10 lignes) ecrit un nouvel enregistrement dans `histo_sessions_caisse` (caisse_session) en mode Write, et 121.6.2.3.1 cree l'enregistrement coffre2 correspondant dans `sessions_coffre2` (caisse_session_coffre2). 121.6.2.4 initialise la table temporaire de saisie des devises `saisie_approvisionnement` (caisse_saisie_appro_dev) pour le comptage initial des especes. Le programme delegue le processus complet d'ouverture a [Ouverture caisse (IDE 122)](ADH-IDE-122.md) et l'initialisation des devises a [Init devise session WS (IDE 141)](ADH-IDE-141.md).
- **121.6.2.2** - Controle monnaie/produit (13 lignes, lit table 198)
121.6.7 "Historique" (2 lignes) ouvre l'ecran de consultation des sessions passees en appelant [Historique session (IDE 132)](ADH-IDE-132.md). 121.6.8 "Consultation" (4 lignes) permet de consulter le detail d'une session specifique via [Affichage sessions (IDE 119)](ADH-IDE-119.md). 121.6.9 "reimprimer tickets" (2 lignes) relance l'impression des tickets de fermeture via [Reimpression tickets fermeture (IDE 151)](ADH-IDE-151.md) et des tickets d'approvisionnement/remise via [Ticket appro remise (IDE 139)](ADH-IDE-139.md).
| [121.6](#t7) | Gestion de la caisse **[[ECRAN]](#ecran-t7)** | Traitement |
| [121.6.12](#t32) | Concurrence sessions for devel **[[ECRAN]](#ecran-t32)** | Traitement |
#### <a id="t7"></a>121.6 - Gestion de la caisse [[ECRAN]](#ecran-t7)
**Ecran** : 939 x 178 DLU (MDI) | [Voir mockup](#ecran-t7)
#### <a id="t32"></a>121.6.12 - Concurrence sessions for devel [[ECRAN]](#ecran-t32)
**Ecran** : 524 x 236 DLU (MDI) | [Voir mockup](#ecran-t32)
Controles de coherence : 2 taches verifient les donnees et conditions.
#### <a id="t3"></a>121.2 - Controle COFFRE2
**Role** : Verification : Controle COFFRE2.
**Delegue a** : [Controle fermeture caisse WS (IDE 155)](ADH-IDE-155.md), [Verif session caisse ouverte2 (IDE 156)](ADH-IDE-156.md)
#### <a id="t11"></a>121.6.2.2 - Controle monnaie/produit
**Role** : Verification : Controle monnaie/produit.
**Delegue a** : [Controle fermeture caisse WS (IDE 155)](ADH-IDE-155.md), [Verif session caisse ouverte2 (IDE 156)](ADH-IDE-156.md)
<!-- TAB:Ecrans -->
## 8. ECRANS
### 8.1 Forms visibles (2 / 32)
### 8.2 Mockups Ecrans
#### <a id="ecran-t7"></a>121.6 - Gestion de la caisse

REFERENCE PATTERN:
```tsx
import { useState, useEffect, useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import { ScreenLayout } from '@/components/layout';
import {
  ExtraitAccountSelector,
  ExtraitTransactionGrid,
  ExtraitFormatDialog,
} from '@/components/caisse/extrait';
import { EmailSendDialog } from '@/components/caisse/dialogs';
import { useExtraitStore } from '@/stores/extraitStore';
import { useAuthStore } from '@/stores';
import type { ExtraitAccountInfo, ExtraitPrintFormat } from '@/types/extrait';

type Phase = 'search' | 'extrait';

export function ExtraitPage() {
  const navigate = useNavigate();
  const user = useAuthStore((s) => s.user);
  const societe = 'ADH';

  const selectedAccount = useExtraitStore((s) => s.selectedAccount);
  const transactions = useExtraitStore((s) => s.transactions);
  const summary = useExtraitStore((s) => s.summary);
  const searchResults = useExtraitStore((s) => s.searchResults);
  const isSearching = useExtraitStore((s) => s.isSearching);
  const isLoadingExtrait = useExtraitStore((s) => s.isLoadingExtrait);
  const isPrinting = useExtraitStore((s) => s.isPrinting);
  const error = useExtraitStore((s) => s.error);
  const searchAccount = useExtraitStore((s) => s.searchAccount);
  const selectAccount = useExtraitStore((s) => s.selectAccount);
  const loadExtrait = useExtraitStore((s) => s.loadExtrait);
  const printExtrait = useExtraitStore((s) => s.printExtrait);
  const reset = useExtraitStore((s) => s.reset);

  const [phase, setPhase] = useState<Phase>('search');
  const [showFormatDialog, setShowFormatDialog] = useState(false);
  const [showEmailDialog, setShowEmailDialog] = useState(false);

  useEffect(() => {
    return () => reset();
  }, [reset]);

  const handleSelectAccount = useCallback(
    (account: ExtraitAccountInfo) => {
      selectAccount(account);
      loadExtrait(societe, account.codeAdherent, account.filiation);
      setPhase('extrait');
    },
    [selectAccount, loadExtrait, societe],
  );

  const handlePrintFormat = useCallback(
    async (format: ExtraitPrintFormat) => {
      if (!selectedAccount) return;
      await printExtrait(
        societe,
        selectedAccount.codeAdherent,
        selectedAccount.filiation,
        format,
      );
      setShowFormatDialog(false);
    },
    [selectedAccount, printExtrait, societe],
  );

  const handleBack = () => {
    if (phase === 'extrait') {
      reset();
      setPhase('search');
    } else {
      navigate('/caisse/menu');
    }
  };

  return (
    <ScreenLayout>
      <div className="space-y-6 max-w-4xl mx-auto">
        <div className="flex items-center justify-between">
          <div>
            <h2 className="text-xl font-semibold">Extrait de compte</h2>
            <p className="text-on-surface-muted text-sm mt-1">
              {phase === 'search'
                ? 'Rechercher un compte adherent'
                : `Compte: ${selectedAccount?.nom} ${selectedAccount?.prenom} #${selectedAccount?.codeAdherent}`}
            </p>
          </div>
          {user && (
            <span className="text-xs text-on-surface-muted">
              {user.prenom} {user.nom}
            </span>
          )}
        </div>

        {error && (
          <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm">
            {error}
          </div>
        )}

        {phase === 'search' && (
          <>
            <ExtraitAccountSelector
              onSelect={handleSelectAccount}
              onSearch={(q) => searchAccount(societe, q)}
              searchResults={searchResults}
              isSearching={isSearching}
              isLoading={isLoadingExtrait}
            />
            <div className="flex justify-start">
              <button
                onClick={handleBack}
                className="px-4 py-2 border border-border rounded-md text-on-surface hover:bg-surface-hover"
              >
                Retour au menu
              </button>
            </div>
          </>
        )}

        {phase === 'extrait' && (
          <>
            <ExtraitTransactionGrid
              transactions={transactions}
              summary={summary}
              isLoading={isLoadingExtrait}
            />

            <div className="flex gap-3 justify-between">
              <button
                onClick={handleBack}
                className="px-4 py-2 border border-border rounded-md text-on-surface hover:bg-surface-hover"
              >
                Nouvelle recherche
              </button>
              <div className="flex gap-3">
                <button
                  onClick={() => setShowEmailDialog(true)}
                  className="px-4 py-2 border border-border rounded-md text-on-surface hover:bg-surface-hover"
                >
                  Envoyer par email
                </button>
                <button
                  onClick={() => setShowFormatDialog(true)}
                  className="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark"
                >
                  Imprimer
                </button>
              </div>
            </div>

            <ExtraitFormatDialog
              open={showFormatDialog}
              onClose={() => setShowFormatDialog(false)}
              onSelectFormat={handlePrintFormat}
              isPrinting={isPrinting}
            />

            <EmailSendDialog
              open={showEmailDialog}
              onClose={() => setShowEmailDialog(false)}
              documentType="extrait"
              documentId={selectedAccount ? String(selectedAccount.codeAdherent) : ''}
            />
          </>
        )}
      </div>
    </ScreenLayout>
  );
}

```