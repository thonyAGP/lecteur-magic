{
  "programId": 155,
  "programName": "Controle fermeture caisse WS",
  "coveragePct": 42,
  "rulesImplemented": 2.5,
  "rulesTotal": 6,
  "missingRules": [
    "RM-004: Condition Param K/T [A]='T' - Pas de validation explicite pour le mode 'T' vs 'K'",
    "RM-005: Configuration VG78 avec Terminal coffre2 - L'implémentation existe (configurerCoffre2) mais pas reliée à VG78",
    "RM-006: Négation de VG78 - Aucune gestion explicite du cas NOT VG78"
  ],
  "incompleteRules": [
    "RM-001: Param UNI/BI='B' implémenté partiellement - Validation existe mais target_file incorrect (saisieContenuCaisseStore au lieu de controleFermetureCaisseStore)",
    "RM-002: Condition composite 2 caisses implémentée partiellement - Target file incorrect (ouvertureTicketGenerator au lieu du store)",
    "RM-003: Param K/T='K' implémenté partiellement - Target file incorrect (test au lieu du store)"
  ],
  "tablesCoverage": {
    "implemented": 3,
    "missing": 18,
    "total": 21,
    "details": {
      "implemented": [
        "devises__________dev (table 90)",
        "change___________chg (table 44)",
        "comptable________cte (table 40)"
      ],
      "missing": [
        "pointage_devise (table 243) - Entité PointageDevise existe mais pas de requête DB",
        "pointage_article (table 242) - Entité PointageArticle existe mais pas de requête DB",
        "pointage_appro_remise (table 241) - Entité PointageApproRemise existe mais pas de requête DB",
        "histo_sessions_caisse (table 246) - Entité HistoSessionsCaisse existe mais pas de requête DB",
        "gestion_devise_session (table 232) - Entité GestionDeviseSession existe mais pas de requête DB",
        "pv_comptable (table 505) - Aucune entité ni requête",
        "pv_discounts (table 510) - Aucune entité ni requête",
        "histo_sessions_caisse_detail (table 249) - Aucune entité ni requête",
        "histo_sessions_caisse_devise (table 250) - Aucune entité ni requête",
        "gm-complet_______gmc (table 31) - Aucune entité ni requête",
        "histo_sessions_caisse_remise (table 251) - Aucune entité ni requête",
        "change_vente_____chg (table 147) - Aucune entité ni requête",
        "droits_applications (table 697) - Aucune entité ni requête",
        "sessions_coffre2 (table 248) - Aucune entité ni requête",
        "histo_sessions_caisse_article (table 247) - Aucune entité ni requête",
        "articles_en_stock (table 197) - Aucune entité ni requête",
        "articles_________art (table 77) - Référencé mais pas de requête spécifique",
        "vente (table 263) - Référencé mais pas de requête spécifique"
      ]
    }
  },
  "calleesCoverage": {
    "implemented": 0,
    "missing": 3,
    "total": 3,
    "details": {
      "missing": [
        "IDE 135 (Generation tableau recap WS) - 13 calls - Fonction genererTableauRecap existe mais pas d'appel au callee",
        "IDE 142 (Devise update session WS) - 11 calls - Fonction mettreAJourDevisesSession existe mais pas d'appel au callee",
        "IDE 152 (Recup Classe et Lib du MOP) - 3 calls - Fonction recupererClasseMoyenPaiement existe mais marquée IMPL dans contract"
      ]
    }
  },
  "apiEndpointsCoverage": {
    "defined": 8,
    "wiredToStore": 8,
    "list": [
      "POST /api/caisse/fermeture/valider-parametres",
      "POST /api/caisse/fermeture/generer-recap",
      "POST /api/caisse/fermeture/calculer-ecarts",
      "POST /api/caisse/fermeture/maj-devises-session",
      "POST /api/caisse/fermeture/finaliser",
      "GET /api/caisse/fermeture/classe-moyen-paiement",
      "GET /api/caisse/fermeture/pointages",
      "POST /api/caisse/fermeture/configurer-coffre2"
    ]
  },
  "uiLayoutCoverage": {
    "pageExists": true,
    "stepWorkflow": true,
    "panelsImplemented": 5,
    "panelsExpected": 5,
    "panels": [
      "ValidationParametresPanel - Présent",
      "GénérationRécapitulatifPanel - Présent",
      "CalculÉcartsPanel - Présent",
      "PointagesFinauxPanel - Présent",
      "FinalisationPanel - Présent"
    ]
  },
  "errorHandlingCoverage": {
    "storeActions": "Présent sur toutes les actions async",
    "apiCalls": "Présent avec try/catch et messages d'erreur explicites",
    "uiValidation": "Présent avec validationErrors state",
    "mockDataFallback": "Présent avec isRealApi check"
  },
  "recommendations": [
    "CRITIQUE: Corriger les target_file dans le contrat - Les règles RM-001, RM-002, RM-003 pointent vers de mauvais fichiers alors que l'implémentation est dans controleFermetureCaisseStore",
    "CRITIQUE: Implémenter la gestion des tables de pointage - Les entités existent mais aucune requête vers pointage_devise, pointage_article, pointage_appro_remise",
    "HAUTE: Implémenter les tables d'historique - histo_sessions_caisse_detail, histo_sessions_caisse_devise, histo_sessions_caisse_remise nécessaires pour la traçabilité",
    "HAUTE: Implémenter les tables pv_comptable et pv_discounts - Nécessaires pour la finalisation comptable",
    "HAUTE: Relier configurerCoffre2 à la variable globale VG78 - La fonction existe mais la condition VG78 (RM-005) n'est pas documentée",
    "MOYENNE: Ajouter validation explicite du mode K/T='T' - Actuellement seule la validation 'K' est testée (RM-003)",
    "MOYENNE: Implémenter la négation VG78 (RM-006) - Ajouter gestion du cas NOT VG78 dans configurerCoffre2",
    "MOYENNE: Implémenter les appels aux callees - genererTableauRecap devrait appeler IDE 135, mettreAJourDevisesSession devrait appeler IDE 142",
    "BASSE: Typer tableauRecap au lieu de Record<string, unknown>[] - Créer interface TableauRecapRow pour meilleure type-safety",
    "BASSE: Ajouter tests unitaires pour les stores - Actuellement aucun test pour controleFermetureCaisseStore.ts",
    "BASSE: Documenter la relation entre les 5 panels et les 147 tâches du programme Magic - Mapper les panels UI aux tâches métier"
  ],
  "strengths": [
    "Architecture store bien structurée avec actions async et état centralisé",
    "Gestion mock/real API élégante avec useDataSourceStore",
    "8 endpoints API bien définis et câblés au store",
    "Workflow UI en 5 étapes avec step navigation",
    "Gestion d'erreur complète sur toutes les actions async",
    "Types TypeScript bien définis pour toutes les entités",
    "Séparation claire types/store/endpoints/components",
    "Mock data réaliste pour développement frontend"
  ],
  "criticalGaps": [
    "18/21 tables manquantes (86%) - Seulement 3 tables réellement implémentées",
    "3/6 règles métier manquantes (50%) - RM-004, RM-005, RM-006 non implémentées",
    "3/3 callees manquants (100%) - Aucun appel aux programmes IDE 135, 142, 152",
    "Target files incorrects dans le contrat pour 3/6 règles"
  ],
  "contractAccuracy": {
    "targetFilesCorrect": 2,
    "targetFilesIncorrect": 4,
    "statusAccurate": false,
    "notes": "Le contrat marque RM-001, RM-002, RM-003 comme IMPL mais avec de mauvais target_file. L'implémentation réelle est dans controleFermetureCaisseStore.ts, pas dans saisieContenuCaisseStore.ts, ouvertureTicketGenerator.ts ou approTicketStore.test.ts"
  },
  "summary": "Le code généré couvre 42% de la spécification ADH IDE 155. L'architecture store/API est solide mais la couverture tables (14%) et callees (0%) est critique. Les 5 panels UI sont présents et fonctionnels. Le principal gap est l'absence de requêtes DB pour 18/21 tables et l'absence d'appels aux 3 programmes callees. Les règles métier UNI/BI et 2 caisses sont implémentées mais les target_file dans le contrat sont incorrects. Recommandation: mettre à jour le contrat puis implémenter les tables de pointage et d'historique."
}
