{
  "programId": 179,
  "programName": "Set Village Address",
  "coveragePct": 95,
  "rulesImplemented": 19,
  "rulesTotal": 20,
  "missingRules": [
    "Expression 7: SetParam ('VI_CITY',Trim([H])) - Le champ 'city' n'appara√Æt pas dans les types ni dans le formulaire"
  ],
  "gaps": [
    {
      "severity": "MEDIUM",
      "category": "DATA_MAPPING",
      "description": "Variable locale [H] (City) manquante",
      "details": "La spec montre 10 expressions SetParam incluant VI_CITY pour la variable [H], mais le code ne contient aucun champ 'city' dans VillageAddress ou VillageAddressFormData",
      "impact": "Perte d'une donn√©e lors de la sauvegarde de l'adresse du village",
      "location": "types/villageAddress.ts, stores/villageAddressStore.ts"
    },
    {
      "severity": "LOW",
      "category": "API_MISMATCH",
      "description": "Endpoints API non document√©s dans la spec",
      "details": "Le code impl√©mente GET /api/village-address et PUT /api/village-address, mais la spec ne liste aucun programme appel√© (0 callees)",
      "impact": "Divergence documentation/impl√©mentation (mineur car les endpoints sont coh√©rents avec le comportement attendu)",
      "location": "services/api/endpoints-villageAddress.ts"
    },
    {
      "severity": "INFO",
      "category": "VALIDATION",
      "description": "Validation SIRET/VAT non impl√©ment√©e",
      "details": "Le formulaire accepte SIRET (maxLength=14) et VAT (maxLength=13) mais ne valide pas le format exact",
      "impact": "Aucun (spec ne mentionne pas de r√®gles de validation explicites)",
      "location": "pages/VillageAddressPage.tsx, components/caisse/villageAddress/LegalInfoPanel.tsx"
    }
  ],
  "implementationDetails": {
    "typesImplemented": [
      "VillageAddress (interface principale avec 9 champs)",
      "VillageAddressFormData (formulaire avec 9 champs)",
      "VillageAddressState (Zustand store state)",
      "SetVillageAddressRequest (DTO API)",
      "SetVillageAddressResponse (API response)",
      "GetVillageAddressResponse (API response avec timestamp)",
      "VILLAGE_ADDRESS_MOCK_DATA (3 jeux de donn√©es mock)"
    ],
    "tablesMapping": {
      "pv_budget": "Table ID 372 list√©e en READ-ONLY dans la spec, mais pas explicitement mapp√©e dans le code car aucune colonne identifi√©e"
    },
    "apiEndpoints": [
      "GET /api/village-address (loadVillageAddress)",
      "PUT /api/village-address (setVillageAddress)"
    ],
    "uiComponents": [
      "VillageAddressPage (page principale)",
      "VillageInfoPanel (clubCode, name)",
      "ContactInfoPanel (phone, email)",
      "LegalInfoPanel (siret, vatNumber)",
      "ActionsPanel (save/cancel buttons)"
    ],
    "storeActions": [
      "setVillageAddress (async)",
      "loadVillageAddress (async)",
      "clearError",
      "reset"
    ],
    "expressionsCovered": {
      "total": 10,
      "implemented": 9,
      "missing": 1,
      "details": [
        "‚úÖ SetParam('VI_CLUB', [B]) ‚Üí clubCode",
        "‚úÖ SetParam('VI_NAME', [C]) ‚Üí name",
        "‚úÖ SetParam('VI_ADR1', [D]) ‚Üí address1",
        "‚úÖ SetParam('VI_ADR2', [E]) ‚Üí address2",
        "‚úÖ SetParam('VI_ZIPC', Trim([F])) ‚Üí zipCode",
        "‚úÖ SetParam('VI_PHON', Trim([G])) ‚Üí phone",
        "‚ùå SetParam('VI_CITY', Trim([H])) ‚Üí MANQUANT",
        "‚úÖ SetParam('VI_MAIL', Trim([I])) ‚Üí email",
        "‚úÖ SetParam('VI_SIRE', Trim([J])) ‚Üí siret",
        "‚úÖ SetParam('VI_VATN', Trim([K])) ‚Üí vatNumber"
      ]
    }
  },
  "recommendations": [
    "üî¥ CRITIQUE: Ajouter le champ 'city' (ville) dans VillageAddress, VillageAddressFormData, et le formulaire VillageInfoPanel. Mapper √† la variable locale [H] selon la spec.",
    "üü° AM√âLIORATION: Ajouter une validation de format pour SIRET (14 chiffres) et VAT (pattern FR + 11 chiffres).",
    "üü° AM√âLIORATION: Mapper explicitement la table pv_budget (ID 372) m√™me si utilis√©e en link-only, pour tra√ßabilit√©.",
    "üü¢ BONNE PRATIQUE: Le code utilise correctement Trim() sur les champs textuels comme sp√©cifi√© dans les expressions 5-10.",
    "üü¢ BONNE PRATIQUE: La gestion dual mock/API est impl√©ment√©e de mani√®re coh√©rente dans le store.",
    "üü¢ BONNE PRATIQUE: La structure des composants suit le pattern √©tabli (Panel s√©par√©s, validation, disabled state).",
    "üü¢ BONNE PRATIQUE: Les types d√©finissent correctement les champs optionnels (address2, phone, email, siret, vatNumber) avec `| null`."
  ],
  "coverageBreakdown": {
    "dataModel": {
      "score": 90,
      "notes": "9/10 champs mapp√©s (manque city)"
    },
    "api": {
      "score": 100,
      "notes": "GET et PUT impl√©ment√©s, dual mock/API fonctionnel"
    },
    "ui": {
      "score": 95,
      "notes": "Formulaire complet sauf champ city, validation pr√©sente"
    },
    "storeLogic": {
      "score": 100,
      "notes": "Actions compl√®tes, error handling, loading states"
    },
    "tableMapping": {
      "score": 80,
      "notes": "Table pv_budget identifi√©e mais pas explicitement utilis√©e (link-only)"
    }
  },
  "summary": "Le code g√©n√©r√© est de haute qualit√© avec une couverture de 95%. L'impl√©mentation est quasi-compl√®te et suit les bonnes pratiques √©tablies. Le gap principal est l'absence du champ 'city' qui devrait √™tre ajout√© selon les 10 expressions SetParam list√©es dans la spec (expression 7: VI_CITY pour variable [H]). Les composants UI sont bien structur√©s, la gestion d'√©tat est propre, et la validation est pr√©sente. Recommandation: ajouter le champ city avant int√©gration."
}
